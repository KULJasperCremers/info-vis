<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/nouislider/distribute/nouislider.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nouislider/distribute/nouislider.min.js"></script>

</head>
<body>

    <div id="map"></div>

    <h1 id="country"></h1>
    
    <div id="stuff" class="container mt-3">
        <!-- First Row -->
        <div class="row">
            <!-- Content for Row 1, Column 1 -->
            <div class="col">
                <div id="circles" class="col" ></div>

            </div>
            <div id="mostPopularLeaning" class="col">
                <!-- Content for Row 1, Column 2 -->
                Row 1, Column 2
            </div>
        </div>
    
        <!-- Second Row -->
        <div class="row">
        <div class="col">
            <!-- Content for Row 2, Column 1 -->
            Row 2, Column 1
        </div>
        <div class="col">
            <!-- Content for Row 2, Column 2 -->
            Row 2, Column 2
        </div>
        </div>
    </div>

</body>

<script src="datahelper.js"></script>
<script src="map.js"></script>
<script>

    var minimized = false;
    var selectedCountry = undefined; 

    DrawMap();

    function OnHoverCountry(countryCode) {
    }

    function OnClickCountry(countryCode) {
        console.log("click: " + countryCode);
        
        selectedCountry = countryCode;

        document.getElementById("country").innerText=countryCode;
        if (!minimized) {
            SwitchMap();
        }
    }

    function SwitchMap() {
        minimized = !minimized;
        DrawMap();
    }

    function DrawMap() {
        d3.select('#map').selectAll('*').remove();

        if (!minimized) {

            var w = window.innerWidth * 0.9;
            var h = w / 2;

            var svg = AppendMap('#map', OnHoverCountry, OnClickCountry, w, h);
            d3.select('#map').classed('minimized', false);
            d3.select('#map').classed('maximized', true);

            document.getElementById('stuff').classList.add('hidden');

            OnMaximized();

        } else {
            var svg = AppendMap('#map', OnHoverCountry, OnClickCountry, 500, 300);
            d3.select('#map').classed('minimized', true);
            d3.select('#map').classed('maximized', false);

            svg.append("image")
                .attr("xlink:href", "https://cdn.icon-icons.com/icons2/390/PNG/512/expand_38551.png") // Ensure the use of xlink:href for compatibility
                .attr("x", 10)
                .attr("y", 10)
                .attr("width", 30)
                .attr("height", 30)
                .on("click", function() {
                    SwitchMap();
                });

            document.getElementById('stuff').classList.remove('hidden');
            
            OnMinimized();
        }

    }

    window.addEventListener('resize', function(event) {
        DrawMap();
    }, true);
  
    function OnMinimized() {

        d3.json("../json/ess_data_all.json").then(function(cdata) {

            // First, select the div where you want to append the SVG
            const div = d3.select("#circles");
            
            // Clear previous SVG if exists
            div.selectAll("svg").remove();
            
            const svg = div.append("svg")
            .attr("width", 400) // Set the width as needed or dynamically
            .attr("height", 400) // Set the height as needed or dynamically
            .style("border", "1px solid black"); // Optional: added a border to visualize the SVG area
        
            var countryCodes = {
                "Austria": "AT",
                "Belgium": "BE",
                "Germany": "DE",
                "Denmark": "DK",
                "Greece": "EL",
                "Spain": "ES",
                "Finland": "FI",
                "France": "FR",
                "Ireland": "IE",
                "Italy": "IT",
                "Luxembourg": "LU",
                "Netherlands": "NL",
                "Portugal": "PT",
                "Sweden": "SE",
            }

            const flattenedCircles = getPercentageCircles(cdata, countryCodes[selectedCountry], 0, 1000, 1000)

            // Draw circles
            svg.selectAll("circle")
                .data(flattenedCircles)
                .enter().append("circle")
                .attr("cx", d => d.cx / 2)
                .attr("cy", d => d.cy / 2)
                .attr("r", d => d.radius)
                .style("fill", (d, i) => d.color);
            });
     
        d3.json("../json/ess_data_all.json").then(function(cdata) {

            // First, select the div where you want to append the SVG
            const div = d3.select("#mostPopularLeaning");

            // Clear previous SVG if exists
            div.selectAll("svg").remove();

            const most = getLeaningDataAtIndex(cdata, countryCodes[selectedCountry], 0);
            console.log(most)

        });

    }

    function OnMaximized() {

    }

</script>

</html>

<style>
    

    .minimized {
        position: fixed;
        bottom: 10px;
        right: 10px;
        border-style: groove;
        z-index: 1000; /* Ensure it sits on top of other content */
    }

    .maximized {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh; /* Example height - adjust as needed */
    }

    .hidden {
        display: none;
    }

</style>